@using Microsoft.AspNetCore.Identity
@using Entidades.Entidades

@model Dominio.EntidadesDto.UsuarioDto
@inject UserManager<UsuarioApp> UserManager

@{
    var TituloFormulario = (ViewBag.Origen == 1) ? "Editar Información" : "Nuevo Usuario";
    var TituloBtn = (ViewBag.Origen == 1) ? "Actualizar Usuario" : "Guardar Usuario";

}


@*LIBRERIA DE INPUT MASK*@
<script src="~/bower_components/inputmask/dist/min/inputmask/jquery.inputmask.min.js"></script>
<script src="~/bower_components/inputmask/dist/inputmask/bindings/inputmask.binding.js"></script>

<div class="modal fade" id="modal-editUser" data-backdrop="static" style="display:none">
    <div class="modal-dialog animated fadeIn">
        <div class="box box-success">
            <div class="box-header with-border">
                <div>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                <h4 class="modal-title text-center">
                    <i class="fa fa-edit"></i>
                    <strong>@TituloFormulario</strong>
                </h4>
            </div>

            <div id="formularioDoc" class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <form id="formDoc" asp-controller="Account" asp-action="GuardarUser"
                              data-ajax="true"
                              data-ajax-method="POST"
                              data-ajax-begin="onBegin"
                              data-ajax-complete="onComplete"
                              data-ajax-success="onSuccessEdit"
                              data-ajax-failure="onFailEdit">

                            <div class="row">
                                <div class="col-md-6">
                                    <label>Nombres:</label>
                                    <div id="contentNombre" class="form-group">
                                        <input type="text" asp-for="Id" class="form-control" readonly="readonly" style="display:none">
                                        <input type="text" asp-for="Nombres" class="form-control" maxlength="200" placeholder="Escriba el nombre del Usuario">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <label>Apellidos:</label>
                                    <div id="contentNombre" class="form-group">
                                        <input type="text" asp-for="Apellidos" class="form-control" maxlength="200" placeholder="Escriba el nombre del Usuario">
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <label>Nombre de Usuario:</label>
                                    <div id="contentNombre" class="form-group">
                                        @if (ViewBag.Origen == 1)
                                        {
                                            <input type="text" asp-for="OrigenForm" class="form-control" readonly="readonly" value="1" style="display:none">
                                            @if (ViewBag.Rol == "Administrador")
                                            {
                                                <input type="text" asp-for="UserName" class="form-control" placeholder="Escriba el nombre del Usuario">
                                            }
                                            else
                                            {
                                                <input type="text" asp-for="UserName" class="form-control" readonly="readonly" placeholder="Escriba el nombre del Usuario">
                                            }
                                        }
                                        else if (ViewBag.Origen == 2)
                                        {
                                            <input type="text" asp-for="OrigenForm" class="form-control" readonly="readonly" value="2" style="display:none">
                                            <input type="text" asp-for="UserName" class="form-control" placeholder="Escriba el nombre del Usuario">
                                        }
                                        else if (ViewBag.Origen == 3)
                                        {
                                            <input type="text" asp-for="OrigenForm" class="form-control" readonly="readonly" value="3" style="display:none">
                                            <input type="text" asp-for="UserName" class="form-control" placeholder="Escriba el nombre del Usuario">
                                        }
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label>Rol:</label>
                                    @if (ViewBag.Origen == 1)
                                    {
                                        @if (ViewBag.Rol == "Administrador")
                                        {
                                            <div id="contentNombre" class="form-group">
                                                @Html.DropDownListFor(r => r.Rol,
                                                                            (IEnumerable<SelectListItem>)(ViewBag.Roles),
                                                                            "..:: Seleccione un Rol ::..",
                                                                            new { @class = "form-control" })
                                            </div>
                                        }
                                        else
                                        {
                                            <div id="contentNombre" class="form-group">
                                                @Html.DropDownListFor(r => r.Rol,
                                                         (IEnumerable<SelectListItem>)(ViewBag.Roles),
                                                         "..:: Seleccione un Rol ::..",
                                                         new { @class = "form-control", @disabled = "disabled" })
                                            </div>
                                        }
                                    }
                                    else
                                    {
                                        <div id="contentNombre" class="form-group">
                                            @Html.DropDownListFor(r => r.Rol,
                                                     (IEnumerable<SelectListItem>)(ViewBag.Roles),
                                                     "..:: Seleccione un Rol ::..",
                                                     new { @class = "form-control"})
                                        </div>
                                    }
                                </div>
                            </div>
                            @if (ViewBag.Origen == 2)
                            {
                                <div class="row">
                                    <div class="col-md-6">
                                        <label>Contraseña:</label>
                                        <div id="contentNombre" class="form-group">
                                            <input type="password" autocomplete="off" asp-for="contra" class="form-control" maxlength="200" placeholder="Escriba la contraseña">
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <label>Contraseña:</label>
                                        <div id="contentNombre" class="form-group">
                                            <input type="password" autocomplete="off" asp-for="contraConfirm" class="form-control" maxlength="200" placeholder="Escriba nuevamente la contraseña">
                                        </div>
                                    </div>
                                </div>
                            }

                            <div class="row">
                                <div class="col-md-6">
                                    <label>Fecha de Nacimiento:</label>
                                    <div id="contentNombre" class="form-group">
                                        <input type="date" asp-for="FechaNacimiento" class="form-control" maxlength="200" placeholder="Dijite la fecha de nacimiento del Usuario">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <label>Sexo:</label>
                                    <div id="contentNombre" class="form-group">
                                        <div class="row">
                                            <div class="col-md-4"><input type="radio" name="Sexo" value='M' asp-for="Sexo" />   Masculino</div>
                                            <div class="col-md-4"><input type="radio" name="Sexo" value='F' asp-for="Sexo" />   Femenino</div>
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <label>Dirección:</label>
                                    <div id="contentDescripcion" class="form-group">
                                        <textarea asp-for="Direccion" class="form-control" placeholder="Dirección del usuario" style="resize:none"></textarea>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <label>Telefono:</label>
                                    <div id="contentNombre" class="form-group">
                                        <input type="tel" asp-for="PhoneNumber" data-inputmask="'mask': '(505) 9999-9999'" data-mask="" class="form-control" placeholder="Escriba el nombre del Usuario">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <label>Correo Electrónico:</label>
                                    <div id="contentNombre" class="form-group">
                                        <input type="text" asp-for="Email" class="form-control" placeholder="Escriba el nombre del Usuario">
                                    </div>
                                </div>
                            </div>

                            <br />
                            <div class="row">
                                <div class="col-lg-8 col-lg-offset-2">
                                    <button class="btn btn-block btn-verde redondeo shadow grow" type="submit">
                                        <i class="fa fa-save"></i> @TituloBtn
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function onBegin() {
        IniciarLoad('#formularioDoc');
    };
    function onComplete() {
        // Escondemos el Ajax Loader
        CerrarLoad('#formularioDoc');
    };

    function onSuccessEdit(response) {
        var origen = $('#OrigenForm').val();
        SuccessGuardarJq(response, HideModalUsuario);
        if (origen == 1) {
            ShowDatosPersonales();
        } else {
            ShowUsuarios();
        }
    }
    function onFailEdit(response) {
        FailMensaje(response.responseJSON);
    }
    function HideModalUsuario() {
        $('#modal-editUser').modal("hide");
    }

</script>


